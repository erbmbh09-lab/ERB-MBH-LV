<div class="space-y-6 animate-fade-in">
  <!-- Tabs -->
  <div class="border-b border-gray-200 dark:border-gray-700">
    <nav class="-mb-px flex space-i-8" aria-label="Tabs">
      <button 
        (click)="activeCategory.set('Office')"
        class="whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm"
        [class.border-primary-500]="activeCategory() === 'Office'"
        [class.text-primary-600]="activeCategory() === 'Office'"
        [class.border-transparent]="activeCategory() !== 'Office'"
        [class.text-gray-500]="activeCategory() !== 'Office'">
        المكاتب
      </button>
      <button 
        (click)="activeCategory.set('Vehicle/Resource')"
        class="whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm"
        [class.border-primary-500]="activeCategory() === 'Vehicle/Resource'"
        [class.text-primary-600]="activeCategory() === 'Vehicle/Resource'"
        [class.border-transparent]="activeCategory() !== 'Vehicle/Resource'"
        [class.text-gray-500]="activeCategory() !== 'Vehicle/Resource'">
        الموارد والمركبات
      </button>
    </nav>
  </div>

  <!-- Content -->
  <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-md">
    <div class="flex justify-between items-center mb-4">
      <h3 class="text-xl font-bold">
        @if (activeCategory() === 'Office') {
          <span>قائمة المكاتب والفروع</span>
        } @else {
          <span>قائمة الموارد والمركبات</span>
        }
      </h3>
      <button (click)="openModal()" class="flex items-center gap-2 px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors shadow-md">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4" /></svg>
        <span>إضافة أصل جديد</span>
      </button>
    </div>

    <!-- Assets Table -->
    <div class="overflow-x-auto">
      <table class="w-full text-right text-sm text-gray-500 dark:text-gray-400">
        <thead class="text-xs text-gray-700 uppercase bg-gray-50 dark:bg-gray-700 dark:text-gray-400">
          <tr>
            <th scope="col" class="px-6 py-3">اسم الأصل/المستند</th>
            <th scope="col" class="px-6 py-3">الفرع</th>
            <th scope="col" class="px-6 py-3">تاريخ الإصدار</th>
            <th scope="col" class="px-6 py-3">تاريخ الانتهاء</th>
            <th scope="col" class="px-6 py-3">ملاحظات</th>
            <th scope="col" class="px-6 py-3">إجراءات</th>
          </tr>
        </thead>
        <tbody>
          @for (asset of filteredAssets(); track asset.id) {
            <tr class="bg-white border-b dark:bg-gray-800 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600">
              <td class="px-6 py-4 font-medium text-gray-900 dark:text-white">
                <div>{{ asset.name }}</div>
                <div class="text-xs text-gray-500">{{ asset.documentType }}</div>
              </td>
              <td class="px-6 py-4"><span class="px-2 py-1 text-xs rounded-full bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-300">{{ asset.branch }}</span></td>
              <td class="px-6 py-4">{{ asset.issueDate | date: 'longDate' }}</td>
              <td class="px-6 py-4 font-semibold text-primary-600 dark:text-primary-400">{{ asset.expiryDate | date: 'longDate' }}</td>
              <td class="px-6 py-4">{{ asset.notes || '-' }}</td>
              <td class="px-6 py-4">
                <div class="flex items-center gap-2">
                  <button (click)="openModal(asset)" class="text-primary-600 dark:text-primary-400 p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full" title="تعديل">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z" /></svg>
                  </button>
                  <button (click)="deleteAsset(asset.id)" class="text-red-500 p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full" title="حذف">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" /></svg>
                  </button>
                </div>
              </td>
            </tr>
          } @empty {
            <tr>
              <td colspan="6" class="px-6 py-12 text-center text-gray-500 dark:text-gray-400">
                <p>لا توجد أصول مضافة لهذه الفئة.</p>
              </td>
            </tr>
          }
        </tbody>
      </table>
    </div>
  </div>

  <!-- Add/Edit Asset Modal -->
  @if (isModalVisible()) {
    <div class="fixed inset-0 bg-black/60 z-50 flex items-center justify-center animate-fade-in" (click)="closeModal()">
      <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-2xl w-full max-w-2xl flex flex-col transform transition-all duration-300 scale-95 animate-scale-in" (click)="$event.stopPropagation()">
        <form [formGroup]="assetForm" (ngSubmit)="onSubmit()">
          <header class="flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700">
            <h2 class="text-xl font-bold text-gray-800 dark:text-white">
              {{ editingAssetId() ? 'تعديل أصل' : 'إضافة أصل جديد' }}
            </h2>
            <button type="button" (click)="closeModal()" class="p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
            </button>
          </header>

          <div class="flex-1 p-6 overflow-y-auto space-y-4 max-h-[70vh]">
            <input type="hidden" formControlName="category">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-medium mb-1">اسم الأصل/المستند <span class="text-red-500">*</span></label>
                <input type="text" formControlName="name" class="w-full p-2 border rounded-md dark:bg-gray-700 dark:border-gray-600">
              </div>
               <div>
                <label class="block text-sm font-medium mb-1">نوع المستند <span class="text-red-500">*</span></label>
                <input type="text" formControlName="documentType" class="w-full p-2 border rounded-md dark:bg-gray-700 dark:border-gray-600">
              </div>
              <div>
                <label class="block text-sm font-medium mb-1">الفرع <span class="text-red-500">*</span></label>
                <select formControlName="branch" class="w-full p-2 border rounded-md dark:bg-gray-700 dark:border-gray-600">
                  <option>دبي</option><option>الشارقة</option><option>عجمان</option><option>عام</option>
                </select>
              </div>
               <div>
                <label class="block text-sm font-medium mb-1">تاريخ الإصدار <span class="text-red-500">*</span></label>
                <input type="date" formControlName="issueDate" class="w-full p-2 border rounded-md dark:bg-gray-700 dark:border-gray-600">
              </div>
              <div>
                <label class="block text-sm font-medium mb-1">تاريخ الانتهاء <span class="text-red-500">*</span></label>
                <input type="date" formControlName="expiryDate" class="w-full p-2 border rounded-md dark:bg-gray-700 dark:border-gray-600">
              </div>
            </div>
             <div>
                <label class="block text-sm font-medium mb-1">تفصيل إضافي (اختياري)</label>
                <div class="flex gap-2">
                    <input type="text" formControlName="detailKey" placeholder="المفتاح (مثال: رقم اللوحة)" class="w-1/3 p-2 border rounded-md dark:bg-gray-700 dark:border-gray-600">
                    <input type="text" formControlName="detailValue" placeholder="القيمة (مثال: دبي A 12345)" class="w-2/3 p-2 border rounded-md dark:bg-gray-700 dark:border-gray-600">
                </div>
            </div>
            <div>
              <label class="block text-sm font-medium mb-1">ملاحظات</label>
              <textarea formControlName="notes" rows="3" class="w-full p-2 border rounded-md dark:bg-gray-700 dark:border-gray-600"></textarea>
            </div>
             <div>
              <label class="block text-sm font-medium mb-1">المرفقات</label>
              <app-file-upload></app-file-upload>
            </div>
          </div>
          
          <footer class="flex justify-end items-center gap-4 p-4 border-t border-gray-200 dark:border-gray-700">
            <button type="button" (click)="closeModal()" class="px-6 py-2 border rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700">إلغاء</button>
            <button type="submit" [disabled]="assetForm.invalid" class="px-6 py-2 bg-primary-600 text-white font-semibold rounded-lg hover:bg-primary-700 disabled:bg-gray-400">حفظ</button>
          </footer>
        </form>
      </div>
    </div>
  }
</div>