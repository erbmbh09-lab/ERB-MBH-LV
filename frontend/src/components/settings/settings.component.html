<div class="space-y-6">
  <div>
    <h2 class="text-3xl font-bold text-gray-800 dark:text-white">الإعدادات</h2>
    <p class="mt-2 text-gray-500 dark:text-gray-400">تخصيص مظهر وسلوك التطبيق، وإدارة تفضيلات الحساب وصلاحيات النظام.</p>
  </div>

  <!-- Tabs Navigation -->
  <div class="border-b border-gray-200 dark:border-gray-700">
    <nav class="-mb-px flex space-x-8 overflow-x-auto" aria-label="Tabs">
      <button 
        (click)="activeTab.set('appearance')"
        class="whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm transition-colors duration-200 focus:outline-none flex items-center gap-2"
        [class.border-primary-500]="activeTab() === 'appearance'"
        [class.text-primary-600]="activeTab() === 'appearance'"
        [class.border-transparent]="activeTab() !== 'appearance'"
        [class.text-gray-500]="activeTab() !== 'appearance'"
        [class.hover:text-gray-700]="activeTab() !== 'appearance'"
        [class.hover:border-gray-300]="activeTab() !== 'appearance'"
        [class.dark:text-gray-400]="activeTab() !== 'appearance'"
        [class.dark:hover:text-gray-200]="activeTab() !== 'appearance'"
        [class.dark:hover:border-gray-500]="activeTab() !== 'appearance'">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 5a1 1 0 011-1h14a1 1 0 011 1v2a1 1 0 01-1 1H5a1 1 0 01-1-1V5zM4 13a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H5a1 1 0 01-1-1v-6zM16 13a1 1 0 011-1h2a1 1 0 011 1v6a1 1 0 01-1 1h-2a1 1 0 01-1-1v-6z" /></svg>
        <span>المظهر</span>
      </button>
      <button 
        (click)="activeTab.set('account')"
        class="whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm transition-colors duration-200 focus:outline-none flex items-center gap-2"
        [class.border-primary-500]="activeTab() === 'account'"
        [class.text-primary-600]="activeTab() === 'account'"
        [class.border-transparent]="activeTab() !== 'account'"
        [class.text-gray-500]="activeTab() !== 'account'"
        [class.hover:text-gray-700]="activeTab() !== 'account'"
        [class.hover:border-gray-300]="activeTab() !== 'account'"
        [class.dark:text-gray-400]="activeTab() !== 'account'"
        [class.dark:hover:text-gray-200]="activeTab() !== 'account'"
        [class.dark:hover:border-gray-500]="activeTab() !== 'account'">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" /></svg>
        <span>الحساب والإشعارات</span>
      </button>
      <button 
        (click)="activeTab.set('permissions')"
        class="whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm transition-colors duration-200 focus:outline-none flex items-center gap-2"
        [class.border-primary-500]="activeTab() === 'permissions'"
        [class.text-primary-600]="activeTab() === 'permissions'"
        [class.border-transparent]="activeTab() !== 'permissions'"
        [class.text-gray-500]="activeTab() !== 'permissions'"
        [class.hover:text-gray-700]="activeTab() !== 'permissions'"
        [class.hover:border-gray-300]="activeTab() !== 'permissions'"
        [class.dark:text-gray-400]="activeTab() !== 'permissions'"
        [class.dark:hover:text-gray-200]="activeTab() !== 'permissions'"
        [class.dark:hover:border-gray-500]="activeTab() !== 'permissions'">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" /></svg>
        <span>صلاحيات النظام</span>
      </button>
      <button 
        (click)="activeTab.set('system')"
        class="whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm transition-colors duration-200 focus:outline-none flex items-center gap-2"
        [class.border-primary-500]="activeTab() === 'system'"
        [class.text-primary-600]="activeTab() === 'system'"
        [class.border-transparent]="activeTab() !== 'system'"
        [class.text-gray-500]="activeTab() !== 'system'"
        [class.hover:text-gray-700]="activeTab() !== 'system'"
        [class.hover:border-gray-300]="activeTab() !== 'system'"
        [class.dark:text-gray-400]="activeTab() !== 'system'"
        [class.dark:hover:text-gray-200]="activeTab() !== 'system'"
        [class.dark:hover:border-gray-500]="activeTab() !== 'system'">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8v2m0-2a2 2 0 100 4m0-4a2 2 0 110 4m0-4v.01M18 14v-2m0 2a2 2 0 100 4m0-4a2 2 0 110 4m0 0v2m-6-8v2m0-2a2 2 0 100 4m0-4a2 2 0 110 4m0 0v.01" /></svg>
        <span>إعدادات النظام</span>
      </button>
       <button 
        (click)="activeTab.set('alerts')"
        class="whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm transition-colors duration-200 focus:outline-none flex items-center gap-2"
        [class.border-primary-500]="activeTab() === 'alerts'"
        [class.text-primary-600]="activeTab() === 'alerts'"
        [class.border-transparent]="activeTab() !== 'alerts'"
        [class.text-gray-500]="activeTab() !== 'alerts'"
        [class.hover:text-gray-700]="activeTab() !== 'alerts'"
        [class.hover:border-gray-300]="activeTab() !== 'alerts'"
        [class.dark:text-gray-400]="activeTab() !== 'alerts'"
        [class.dark:hover:text-gray-200]="activeTab() !== 'alerts'"
        [class.dark:hover:border-gray-500]="activeTab() !== 'alerts'">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9" /></svg>
        <span>إعدادات التنبيهات</span>
      </button>
      <button 
        (click)="activeTab.set('integrations')"
        class="whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm transition-colors duration-200 focus:outline-none flex items-center gap-2"
        [class.border-primary-500]="activeTab() === 'integrations'"
        [class.text-primary-600]="activeTab() === 'integrations'"
        [class.border-transparent]="activeTab() !== 'integrations'"
        [class.text-gray-500]="activeTab() !== 'integrations'"
        [class.hover:text-gray-700]="activeTab() !== 'integrations'"
        [class.hover:border-gray-300]="activeTab() !== 'integrations'"
        [class.dark:text-gray-400]="activeTab() !== 'integrations'"
        [class.dark:hover:text-gray-200]="activeTab() !== 'integrations'"
        [class.dark:hover:border-gray-500]="activeTab() !== 'integrations'">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1" /></svg>
        <span>التكاملات</span>
      </button>
      <button 
        (click)="activeTab.set('logs')"
        class="whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm transition-colors duration-200 focus:outline-none flex items-center gap-2"
        [class.border-primary-500]="activeTab() === 'logs'"
        [class.text-primary-600]="activeTab() === 'logs'"
        [class.border-transparent]="activeTab() !== 'logs'"
        [class.text-gray-500]="activeTab() !== 'logs'"
        [class.hover:text-gray-700]="activeTab() !== 'logs'"
        [class.hover:border-gray-300]="activeTab() !== 'logs'"
        [class.dark:text-gray-400]="activeTab() !== 'logs'"
        [class.dark:hover:text-gray-200]="activeTab() !== 'logs'"
        [class.dark:hover:border-gray-500]="activeTab() !== 'logs'">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5V3a2 2 0 012-2h2a2 2 0 012 2v2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01" /></svg>
        <span>سجلات النظام</span>
      </button>
    </nav>
  </div>
  
  <!-- Tab Content -->
  <div class="pt-4">
    @switch (activeTab()) {
      @case ('appearance') {
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
          <div class="space-y-8">
            <!-- Theme Setting -->
            <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-md animate-fade-in-up">
              <h3 class="text-xl font-bold mb-4">المظهر (Theme)</h3>
              <div class="grid grid-cols-2 gap-4">
                @for(theme of themes; track theme.value) {
                  <button (click)="setTheme(theme.value)" class="relative p-4 rounded-lg border-2 text-center transition-all duration-200"
                    [class.border-primary-500]="themeService.theme() === theme.value"
                    [class.bg-primary-50]="themeService.theme() === theme.value"
                    [class.dark:bg-primary-900/40]="themeService.theme() === theme.value"
                    [class.text-primary-700]="themeService.theme() === theme.value"
                    [class.dark:text-primary-200]="themeService.theme() === theme.value"
                    
                    [class.border-gray-300]="themeService.theme() !== theme.value"
                    [class.dark:border-gray-600]="themeService.theme() !== theme.value"
                    [class.text-gray-600]="themeService.theme() !== theme.value"
                    [class.dark:text-gray-300]="themeService.theme() !== theme.value"
                    [class.hover:border-primary-400]="themeService.theme() !== theme.value"
                    [class.dark:hover:border-primary-500]="themeService.theme() !== theme.value"
                    [class.hover:bg-gray-50]="themeService.theme() !== theme.value"
                    [class.dark:hover:bg-gray-700/50]="themeService.theme() !== theme.value">

                    <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 mx-auto mb-2" fill="none" viewBox="0 0 24" stroke="currentColor" stroke-width="2" [innerHTML]="theme.icon"></svg>
                    <span class="font-semibold">{{ theme.label }}</span>

                    @if (themeService.theme() === theme.value) {
                      <div class="absolute -top-2 -left-2 bg-primary-500 text-white rounded-full p-1">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" /></svg>
                      </div>
                    }
                  </button>
                }
              </div>
            </div>
            
             <!-- Font Setting -->
            <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-md animate-fade-in-up animation-delay-400">
              <h3 class="text-xl font-bold mb-4">نوع الخط</h3>
              <div class="flex flex-col sm:flex-row gap-3">
                @for(font of fonts; track font.value) {
                  <button (click)="setFont(font.value)" class="flex-1 p-3 rounded-lg border-2 transition-colors duration-200"
                    [style]="font.style"
                    [class.border-primary-500]="themeService.font() === font.value"
                    [class.bg-primary-50]="themeService.font() === font.value"
                    [class.dark:bg-primary-900/40]="themeService.font() === font.value"
                    [class.text-primary-700]="themeService.font() === font.value"
                    [class.dark:text-primary-200]="themeService.font() === font.value"

                    [class.border-gray-300]="themeService.font() !== font.value"
                    [class.dark:border-gray-600]="themeService.font() !== font.value"
                    [class.text-gray-600]="themeService.font() !== font.value"
                    [class.dark:text-gray-300]="themeService.font() !== font.value"
                    [class.hover:border-primary-400]="themeService.font() !== font.value"
                    [class.dark:hover:border-primary-500]="themeService.font() !== font.value"
                    [class.hover:bg-gray-50]="themeService.font() !== font.value"
                    [class.dark:hover:bg-gray-700/50]="themeService.font() !== font.value">
                    {{ font.label }}
                  </button>
                }
              </div>
            </div>
          </div>
          <div class="space-y-8">
              <!-- Primary Color Setting -->
              <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-md animate-fade-in-up animation-delay-200">
                <h3 class="text-xl font-bold mb-4">اللون الأساسي</h3>
                <div class="flex flex-wrap gap-4">
                  @for (color of primaryColors; track color.value) {
                    <button (click)="setPrimaryColor(color.value)" [title]="color.label"
                            class="w-10 h-10 rounded-full flex items-center justify-center transition-transform transform hover:scale-110 focus:outline-none focus:ring-2 focus:ring-offset-2 dark:focus:ring-offset-gray-800"
                            [class]="color.bgClass" [class.ring-primary-500]="themeService.primaryColor() === color.value">
                      @if (themeService.primaryColor() === color.value) {
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-white" fill="none" viewBox="0 0 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" /></svg>
                      }
                    </button>
                  }
                </div>
              </div>
              <!-- Language & Region -->
              <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-md animate-fade-in-up animation-delay-600">
                <h3 class="text-xl font-bold mb-4">اللغة</h3>
                <div class="max-w-md">
                    <label for="language" class="block text-sm font-medium text-gray-700 dark:text-gray-300">لغة الواجهة</label>
                    <select id="language" name="language"
                            class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 dark:border-gray-600 focus:outline-none focus:ring-primary-500 focus:border-primary-500 sm:text-sm rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-200">
                      <option value="ar">العربية</option>
                      <option value="en">English</option>
                    </select>
                </div>
              </div>
          </div>
        </div>
      }
      @case('account') {
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            <!-- Account Settings -->
            <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-md animate-fade-in-up">
              <h3 class="text-xl font-bold mb-4">إعدادات الحساب</h3>
              <div class="space-y-4">
                <div>
                  <label class="block text-sm font-medium text-gray-500 dark:text-gray-400">الاسم</label>
                  <p class="text-md font-semibold">{{ user().name }}</p>
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-500 dark:text-gray-400">البريد الإلكتروني</label>
                  <p class="text-md font-semibold">{{ user().email }}</p>
                </div>
                <div class="pt-2">
                  <button class="w-full text-center px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">
                    تغيير كلمة المرور
                  </button>
                </div>
              </div>
            </div>

            <!-- Notification Preferences -->
            <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-md animate-fade-in-up animation-delay-200">
              <h3 class="text-xl font-bold mb-4">تفضيلات الإشعارات</h3>
              <ul class="space-y-4">
                <li class="flex justify-between items-center">
                  <span class="font-medium">تنبيهات الجلسات القادمة</span>
                  <button (click)="toggleNotificationPref('hearings')" [class.bg-primary-600]="notificationPrefs().hearings" [class.bg-gray-200]="!notificationPrefs().hearings" [class.dark:bg-gray-700]="!notificationPrefs().hearings" class="relative inline-flex h-6 w-11 items-center rounded-full transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500">
                    <span [class.translate-x-[-1.5rem]]="notificationPrefs().hearings" [class.translate-x-[-0.25rem]]="!notificationPrefs().hearings" class="inline-block h-4 w-4 transform rounded-full bg-white transition-transform"></span>
                  </button>
                </li>
                <li class="flex justify-between items-center">
                  <span class="font-medium">تحديثات على القضايا</span>
                  <button (click)="toggleNotificationPref('caseUpdates')" [class.bg-primary-600]="notificationPrefs().caseUpdates" [class.bg-gray-200]="!notificationPrefs().caseUpdates" [class.dark:bg-gray-700]="!notificationPrefs().caseUpdates" class="relative inline-flex h-6 w-11 items-center rounded-full transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500">
                    <span [class.translate-x-[-1.5rem]]="notificationPrefs().caseUpdates" [class.translate-x-[-0.25rem]]="!notificationPrefs().caseUpdates" class="inline-block h-4 w-4 transform rounded-full bg-white transition-transform"></span>
                  </button>
                </li>
                <li class="flex justify-between items-center">
                  <span class="font-medium">إشعارات المهام الجديدة</span>
                  <button (click)="toggleNotificationPref('tasks')" [class.bg-primary-600]="notificationPrefs().tasks" [class.bg-gray-200]="!notificationPrefs().tasks" [class.dark:bg-gray-700]="!notificationPrefs().tasks" class="relative inline-flex h-6 w-11 items-center rounded-full transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500">
                    <span [class.translate-x-[-1.5rem]]="notificationPrefs().tasks" [class.translate-x-[-0.25rem]]="!notificationPrefs().tasks" class="inline-block h-4 w-4 transform rounded-full bg-white transition-transform"></span>
                  </button>
                </li>
                <li class="flex justify-between items-center">
                  <span class="font-medium">رسائل النظام والتحديثات</span>
                  <button (click)="toggleNotificationPref('system')" [class.bg-primary-600]="notificationPrefs().system" [class.bg-gray-200]="!notificationPrefs().system" [class.dark:bg-gray-700]="!notificationPrefs().system" class="relative inline-flex h-6 w-11 items-center rounded-full transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500">
                    <span [class.translate-x-[-1.5rem]]="notificationPrefs().system" [class.translate-x-[-0.25rem]]="!notificationPrefs().system" class="inline-block h-4 w-4 transform rounded-full bg-white transition-transform"></span>
                  </button>
                </li>
              </ul>
            </div>
        </div>
      }
      @case ('permissions') {
        <app-permissions></app-permissions>
      }
      @case ('system') {
        <div class="space-y-6 animate-fade-in-up">
          <!-- Official Holidays Management -->
          <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-md">
            <h3 class="text-xl font-bold mb-4">إدارة العطلات الرسمية</h3>
            
            <!-- Add Holiday Form -->
            <form [formGroup]="newHolidayForm" (ngSubmit)="addHoliday()">
              <div class="grid grid-cols-1 md:grid-cols-3 gap-4 items-end border-b pb-6 mb-6 dark:border-gray-700">
                <div class="md:col-span-1">
                  <label for="holiday-name" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">اسم العطلة <span class="text-red-500">*</span></label>
                  <input type="text" id="holiday-name" formControlName="name" placeholder="مثال: اليوم الوطني" class="w-full p-2 border rounded-md dark:bg-gray-700 dark:border-gray-600">
                </div>
                <div>
                  <label for="holiday-date" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">التاريخ <span class="text-red-500">*</span></label>
                  <input type="date" id="holiday-date" formControlName="date" class="w-full p-2 border rounded-md dark:bg-gray-700 dark:border-gray-600">
                </div>
                <button type="submit" [disabled]="newHolidayForm.invalid" class="w-full flex items-center justify-center gap-2 px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-all duration-300 transform hover:shadow-lg hover:-translate-y-0.5 shadow-md disabled:bg-gray-400 disabled:cursor-not-allowed">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd" /></svg>
                  <span>إضافة عطلة</span>
                </button>
              </div>
            </form>
      
            <!-- Holidays List -->
            <div class="overflow-x-auto">
              <table class="w-full text-sm text-right">
                <thead class="text-xs text-gray-700 uppercase bg-gray-50 dark:bg-gray-700 dark:text-gray-400">
                  <tr>
                    <th scope="col" class="px-6 py-3">اسم العطلة</th>
                    <th scope="col" class="px-6 py-3">التاريخ</th>
                    <th scope="col" class="px-6 py-3"><span class="sr-only">إجراء</span></th>
                  </tr>
                </thead>
                <tbody class="text-gray-600 dark:text-gray-300">
                  @for (holiday of officialHolidays(); track holiday.date) {
                    <tr class="bg-white border-b dark:bg-gray-800 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700/50">
                      <td class="px-6 py-4 font-medium">{{ holiday.name }}</td>
                      <td class="px-6 py-4">{{ holiday.date | date:'longDate' }}</td>
                      <td class="px-6 py-4 text-left">
                        <button (click)="removeHoliday(holiday.date)" title="حذف العطلة" class="text-red-500 hover:text-red-700 p-2 rounded-full hover:bg-red-100 dark:hover:bg-red-900/50">
                          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" /></svg>
                        </button>
                      </td>
                    </tr>
                  } @empty {
                    <tr>
                      <td colspan="3" class="px-6 py-10 text-center text-gray-500 dark:text-gray-400">
                        لا توجد عطلات رسمية مسجلة حالياً.
                      </td>
                    </tr>
                  }
                </tbody>
              </table>
            </div>
          </div>
        </div>
      }
      @case('alerts') {
        <div class="space-y-6 animate-fade-in-up">
          <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-md">
            <h3 class="text-xl font-bold mb-4">إدارة قواعد التنبيهات</h3>
            <p class="text-sm text-gray-500 dark:text-gray-400 mb-6">
              أضف قواعد مخصصة لتلقي تنبيهات بانتهاء صلاحية أي مستند أو وثيقة. سيتم عرض التنبيهات في شاشة "التنبيهات والإشعارات" في قسم الموارد البشرية.
            </p>
            
            <!-- Add Alert Rule Form -->
            <form [formGroup]="newAlertRuleForm" (ngSubmit)="addAlertRule()">
              <div class="grid grid-cols-1 md:grid-cols-4 gap-4 items-end border-b pb-6 mb-6 dark:border-gray-700">
                  <div>
                    <label class="block text-sm font-medium mb-1">اسم التنبيه <span class="text-red-500">*</span></label>
                    <input type="text" formControlName="name" placeholder="مثال: انتهاء جواز السفر" class="w-full p-2 border rounded-md dark:bg-gray-700 dark:border-gray-600">
                  </div>
                  <div>
                    <label class="block text-sm font-medium mb-1">الجهة <span class="text-red-500">*</span></label>
                    <select formControlName="target" class="w-full p-2 border rounded-md dark:bg-gray-700 dark:border-gray-600">
                      <option value="Employee">موظف</option>
                      <option value="CompanyAsset">أصل شركة</option>
                    </select>
                  </div>
                   <div>
                    <label class="block text-sm font-medium mb-1">الحقل المراد تتبعه <span class="text-red-500">*</span></label>
                    <select formControlName="dateField" class="w-full p-2 border rounded-md dark:bg-gray-700 dark:border-gray-600">
                      <option value="" disabled>-- اختر حقلاً --</option>
                      @for(field of availableDateFields(); track field.key) {
                        <option [value]="field.key">{{ field.label }}</option>
                      }
                    </select>
                  </div>
                   <div>
                    <label class="block text-sm font-medium mb-1">تذكير قبل (يوم) <span class="text-red-500">*</span></label>
                    <input type="number" formControlName="reminderDays" class="w-full p-2 border rounded-md dark:bg-gray-700 dark:border-gray-600">
                  </div>
                <div class="md:col-span-4 flex justify-end">
                  <button type="submit" [disabled]="newAlertRuleForm.invalid" class="w-full md:w-auto flex items-center justify-center gap-2 px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-all duration-300 transform hover:shadow-lg hover:-translate-y-0.5 shadow-md disabled:bg-gray-400 disabled:cursor-not-allowed">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd" /></svg>
                    <span>إضافة قاعدة تنبيه</span>
                  </button>
                </div>
              </div>
            </form>
      
            <!-- Alert Rules List -->
            <div class="overflow-x-auto">
              <table class="w-full text-sm text-right">
                <thead class="text-xs text-gray-700 uppercase bg-gray-50 dark:bg-gray-700 dark:text-gray-400">
                  <tr>
                    <th scope="col" class="px-6 py-3">اسم التنبيه</th>
                    <th scope="col" class="px-6 py-3">الجهة</th>
                    <th scope="col" class="px-6 py-3">فترة التذكير</th>
                    <th scope="col" class="px-6 py-3"><span class="sr-only">إجراء</span></th>
                  </tr>
                </thead>
                <tbody class="text-gray-600 dark:text-gray-300">
                  @for (rule of alertRules(); track rule.id) {
                    <tr class="bg-white border-b dark:bg-gray-800 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700/50">
                      <td class="px-6 py-4 font-medium">{{ rule.name }}</td>
                      <td class="px-6 py-4">{{ rule.target === 'Employee' ? 'موظف' : 'أصل شركة' }}</td>
                      <td class="px-6 py-4">{{ rule.reminderDays }} يوم</td>
                      <td class="px-6 py-4 text-left">
                        <button (click)="removeAlertRule(rule.id)" title="حذف القاعدة" class="text-red-500 hover:text-red-700 p-2 rounded-full hover:bg-red-100 dark:hover:bg-red-900/50">
                          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" /></svg>
                        </button>
                      </td>
                    </tr>
                  } @empty {
                    <tr>
                      <td colspan="4" class="px-6 py-10 text-center text-gray-500 dark:text-gray-400">
                        لا توجد قواعد تنبيه مخصصة.
                      </td>
                    </tr>
                  }
                </tbody>
              </table>
            </div>
          </div>
        </div>
      }
      @case ('integrations') {
        <div class="animate-fade-in-up">
           <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-md">
            <h3 class="text-xl font-bold mb-2">التكامل مع تقويم جوجل</h3>
            <p class="text-sm text-gray-500 dark:text-gray-400 mb-6">
              اربط حسابك في جوجل لمزامنة جلسات القضايا ومواعيد الأجندة مباشرة مع تقويم جوجل الخاص بك.
            </p>

            <div class="space-y-4">
              <div>
                <label for="google-client-id" class="block text-sm font-medium mb-1">Google Client ID</label>
                <div class="flex flex-col sm:flex-row gap-2">
                  <input type="text" id="google-client-id" [ngModel]="googleClientId()" (ngModelChange)="googleClientId.set($event)" placeholder="ادخل Client ID الخاص بك هنا" class="flex-grow p-2 border rounded-md dark:bg-gray-700 dark:border-gray-600">
                  <button (click)="saveGoogleClientId()" class="px-4 py-2 bg-gray-200 dark:bg-gray-600 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-500 font-semibold">حفظ وإعداد</button>
                </div>
              </div>
              
              <div class="border-t pt-4 dark:border-gray-700">
                @if(googleCalendarService.isReady()) {
                  @if (googleCalendarService.isSignedIn()) {
                    <div class="flex items-center justify-between p-3 bg-green-100 dark:bg-green-900/50 rounded-lg">
                      <div class="flex items-center gap-3">
                        <img [src]="googleCalendarService.userProfile()?.picture" class="w-10 h-10 rounded-full" alt="User profile">
                        <div>
                           <p class="font-bold text-green-800 dark:text-green-200">متصل بحساب جوجل</p>
                           <p class="text-sm text-gray-600 dark:text-gray-300">{{ googleCalendarService.userProfile()?.email }}</p>
                        </div>
                      </div>
                      <button (click)="googleCalendarService.signOut()" class="px-4 py-2 text-sm bg-red-500 text-white rounded-lg hover:bg-red-600">قطع الاتصال</button>
                    </div>
                  } @else {
                    <div class="flex items-center justify-between p-3 bg-gray-100 dark:bg-gray-700 rounded-lg">
                      <p class="font-semibold">الحالة: غير متصل</p>
                      <button (click)="googleCalendarService.signIn()" class="px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700">
                        ربط حساب جوجل
                      </button>
                    </div>
                  }
                } @else {
                   <div class="p-3 bg-yellow-100 dark:bg-yellow-900/50 rounded-lg">
                     <p class="font-semibold text-yellow-800 dark:text-yellow-200">الرجاء حفظ Client ID صالح لتفعيل التكامل.</p>
                   </div>
                }
              </div>
            </div>
          </div>
        </div>
      }
      @case ('logs') {
        <div class="space-y-6 animate-fade-in-up">
            <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-md">
                <h3 class="text-xl font-bold mb-4">سجلات النظام</h3>
                <!-- Filters -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4 p-4 rounded-lg bg-gray-50 dark:bg-gray-700/50 mb-6">
                    <div class="lg:col-span-1">
                        <label class="block text-sm font-medium mb-1">بحث</label>
                        <input type="text" [ngModel]="logSearchTerm()" (ngModelChange)="logSearchTerm.set($event)" placeholder="وصف, IP..." class="w-full p-2 border rounded-md dark:bg-gray-700 dark:border-gray-600">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-1">المستخدم</label>
                        <select [ngModel]="logUserFilter()" (ngModelChange)="logUserFilter.set($event)" class="w-full p-2 border rounded-md dark:bg-gray-700 dark:border-gray-600">
                            <option value="all">كل المستخدمين</option>
                            @for (user of allUsers(); track user.id) {
                                <option [value]="user.id">{{ user.name }}</option>
                            }
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-1">نوع الحدث</label>
                        <select [ngModel]="logEventTypeFilter()" (ngModelChange)="logEventTypeFilter.set($event)" class="w-full p-2 border rounded-md dark:bg-gray-700 dark:border-gray-600">
                            <option value="all">كل الأنواع</option>
                             @for (type of logEventTypes(); track type) {
                                <option [value]="type">{{ type }}</option>
                            }
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-1">من تاريخ</label>
                        <input type="date" [ngModel]="logFromDateFilter()" (ngModelChange)="logFromDateFilter.set($event)" class="w-full p-2 border rounded-md dark:bg-gray-700 dark:border-gray-600">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-1">إلى تاريخ</label>
                        <input type="date" [ngModel]="logToDateFilter()" (ngModelChange)="logToDateFilter.set($event)" class="w-full p-2 border rounded-md dark:bg-gray-700 dark:border-gray-600">
                    </div>
                </div>

                <!-- Logs Table -->
                <div class="overflow-x-auto">
                    <table class="w-full text-sm text-right">
                        <thead class="text-xs text-gray-700 uppercase bg-gray-50 dark:bg-gray-700 dark:text-gray-400">
                            <tr>
                                <th class="px-6 py-3">التوقيت</th>
                                <th class="px-6 py-3">المستخدم</th>
                                <th class="px-6 py-3">نوع الحدث</th>
                                <th class="px-6 py-3">الوصف</th>
                                <th class="px-6 py-3">IP Address</th>
                            </tr>
                        </thead>
                        <tbody class="text-gray-600 dark:text-gray-300">
                            @for (log of filteredLogs(); track log.id) {
                                <tr class="bg-white border-b dark:bg-gray-800 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700/50">
                                    <td class="px-6 py-4 whitespace-nowrap">{{ log.timestamp | date:'yyyy/MM/dd HH:mm:ss' }}</td>
                                    <td class="px-6 py-4 font-medium">{{ getLogUserName(log.userId) }}</td>
                                    <td class="px-6 py-4">
                                        <span class="px-2 py-1 text-xs font-mono rounded-full bg-gray-100 dark:bg-gray-900/50 text-gray-600 dark:text-gray-400">{{ log.eventType }}</span>
                                    </td>
                                    <td class="px-6 py-4">{{ log.description }}</td>
                                    <td class="px-6 py-4 font-mono">{{ log.ipAddress }}</td>
                                </tr>
                            } @empty {
                                <tr>
                                    <td colspan="5" class="px-6 py-10 text-center text-gray-500 dark:text-gray-400">
                                        لا توجد سجلات تطابق معايير البحث.
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
      }
    }
  </div>
</div>